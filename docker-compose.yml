version: "3"
services:
    mongo:
        image: mongo:3.2
        restart: always
        ports:
            - 27017:27017
        networks:
            main:
        volumes:
          - ./../mongo-data:/data/db

    # mysql:
    #     image: mysql:lamain
    #     restart: always
    #     ports:
    #         - 3333:3306
    #     volumes:
    #         - ./../mysql-data:/var/lib/mysql
    #     networks:
    #         main:
    #     environment:
    #         - MYSQL_ROOT_PASSWORD=my-secret-pw
    #         - MYSQL_DATABASE=RSS

    mysql:
        image: mysql:5.7.16
        restart: always
        ports:
            - "3333:3306"
        # volumes:
        #     - /var/lib/mysql
        networks:
            main:
        environment:
            - MYSQL_ROOT_PASSWORD=my-secret-pw
            - MYSQL_HOST=mysql
            - MYSQL_DATABASE=mains
        volumes:
            - ./../mysql-data:/var/lib/mysql

    apis:
        image: conwetlab/biz-ecosystem-apis:develop
        restart: always
        ports:
            - 4848:4848
            - 8080:8080
        links:
            - mysql
        depends_on:
            - mysql
        networks:
            main:
                aliases:
                    - apis.docker
        environment:
            - MYSQL_ROOT_PASSWORD=my-secret-pw
            - MYSQL_HOST=mysql

    proxy:
        image: conwetlab/biz-ecosystem-logic-proxy:develop
        restart: always
        links:
            - mongo
        depends_on:
            - mongo
            - apis
        ports:
            - 8004:8000
        networks:
            main:
                aliases:
                    - proxy.docker
        volumes:
            - ./../proxy-conf:/business-ecosystem-logic-proxy/etc
            - ./../proxy-indexes:/business-ecosystem-logic-proxy/indexes
            - ./../proxy-themes:/business-ecosystem-logic-proxy/themes
            - ./../proxy-static:/business-ecosystem-logic-proxy/static
        environment:
            - NODE_ENV=development

    charging:
        image: conwetlab/biz-ecosystem-charging-backend:develop
        restart: always
        links:
            - mongo
        depends_on:
            - mongo
            - apis
            - rss
        ports:
            - 8006:8006
        networks:
            main:
                aliases:
                    - charging.docker
        volumes:
            - ./../charging-bills:/business-ecosystem-charging-backend/src/media/bills
            - ./../charging-assets:/business-ecosystem-charging-backend/src/media/assets
            - ./../charging-plugins:/business-ecosystem-charging-backend/src/plugins
            - ./../charging-settings:/business-ecosystem-charging-backend/src/user_settings
            - ./../charging-inst-plugins:/business-ecosystem-charging-backend/src/wstore/asset_manager/resource_plugins/plugins
        environment:
          - PAYPAL_CLIENT_ID=client_id
          - PAYPAL_CLIENT_SECRET=client_secret

    rss:
        image: conwetlab/biz-ecosystem-rss:develop
        restart: always
        ports:
            - 9999:8080
            - 4444:4848
            - 1111:8181
        links:
            - mysql
        depends_on:
            - mysql
        networks:
            main:
                aliases:
                    - rss.docker
        volumes:
            - ./../rss-conf:/etc/default/rss

    webdriverio:
        image: webdriverio
        links:
#            - chrome
            - firefox
            - hub
            - proxy
            - mysql
            - apis
            - mongo
            - charging
        networks:
            main:
              aliases:
                - webdriverio.docker
        environment:
            - HUB_PORT_4444_TCP_ADDR=hub.docker
            - HUB_PORT_4444_TCP_PORT=4444
            - MYSQL_ROOT_PASSWORD=my-secret-pw
        volumes:
            # {{replace_with_path_of_wdio.conf.js_file}}
            # - <PATH/TO/YOUR/WEBDRIVERIO/DIR>:/app
            - ./webdriverio:/app
            # in order to make index cleaning easy, put the index volume from login-proxy here
            - ./../proxy-indexes:/proxy-indexes
    hub:
        image: selenium/hub
        ports:
            - 6666:4444
        networks:
            main:
              aliases:
                - hub.docker
        links:
            - proxy
            - mysql
            - apis

    firefox:
        image: selenium/node-firefox-debug
        ports:
            - 5900:5900
        environment:
            - HUB_PORT_4444_TCP_ADDR=hub.docker
            - HUB_PORT_4444_TCP_PORT=4444
        links:
            - hub
            - proxy
            - mysql
            - apis
        networks:
            main:
              aliases:
                - firefox.docker

    # chrome:
    #     image: selenium/node-chrome-debug
    #     ports:
    #         - 5901:5901
    #     environment:
    #         - HUB_PORT_4444_TCP_ADDR=hub.docker
    #         - HUB_PORT_4444_TCP_PORT=4444
    #     links:
    #         - proxy
    #         - mysql
    #         - apis
    #         - hub
    #     networks:
    #         main:
    #           aliases:
    #             - chrome.docker

networks:
    main:
       external: true
